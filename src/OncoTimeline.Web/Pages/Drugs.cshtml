@page
@model DrugsModel
@{
    ViewData["Title"] = "Drug Database";
}

<div x-data='@Html.Raw(System.Text.Json.JsonSerializer.Serialize(new {
    searchQuery = "",
    filteredDrugs = Model.Drugs
}))' class="max-w-7xl mx-auto px-4 py-8">

    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Drug Database</h1>
        <p class="text-gray-600">Comprehensive information about B-ALL treatment medications</p>
    </div>

    <!-- Search -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Search Drugs</label>
        <input type="text" x-model="searchQuery" placeholder="Search by name or category..." 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
    </div>

    <!-- Drugs List -->
    <div class="space-y-6">
        @foreach(var drug in Model.Drugs.OrderByDescending(d => d.IsCurrentlyRelevant))
        {
            <div class="bg-white rounded-lg shadow-lg overflow-hidden @(drug.IsCurrentlyRelevant ? "ring-4 ring-blue-500" : "")">
                <!-- Header -->
                <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-3xl font-bold mb-2">@drug.Name</h2>
                            <p class="text-purple-100 text-lg">@drug.DrugClass</p>
                        </div>
                        @if(drug.IsCurrentlyRelevant)
                        {
                            <span class="bg-green-500 px-4 py-2 rounded-full text-sm font-bold animate-pulse">üü¢ CURRENTLY RELEVANT</span>
                        }
                    </div>
                </div>
                
                <!-- Content -->
                <div class="p-6">
                    <!-- Two Column Layout -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Left Column - Parent Info -->
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üíä</span> What It Does
                                </h3>
                                <p class="text-gray-700 leading-relaxed">@drug.WhyUsedInLeukemia</p>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üëÄ</span> What to Watch For
                                </h3>
                                <p class="text-gray-700 leading-relaxed">@drug.ParentFriendlyExplanation</p>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">‚ö†Ô∏è</span> Common Side Effects
                                </h3>
                                <ul class="space-y-3">
                                    @foreach(var effect in drug.SideEffects.Where(se => se.Severity == "Common"))
                                    {
                                        <li class="flex items-start gap-3 bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400">
                                            <span class="text-yellow-600 text-xl mt-1">‚óè</span>
                                            <div class="flex-1">
                                                <p class="font-semibold text-gray-900">@effect.EffectName</p>
                                                <p class="text-sm text-gray-700">@effect.Description</p>
                                                <p class="text-xs text-gray-500 mt-1">Onset: @effect.TypicalOnset</p>
                                            </div>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Right Column - Technical Info -->
                        <div class="space-y-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="text-xl font-bold text-blue-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üíâ</span> How It's Given
                                </h3>
                                <p class="text-blue-800 font-medium">@drug.DrugClass</p>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üß¨</span> Mechanism of Action
                                </h3>
                                <p class="text-gray-700 leading-relaxed">@drug.MechanismOfAction</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-900 mb-2 flex items-center gap-1">
                                        <span>‚è±Ô∏è</span> Onset
                                    </h4>
                                    <p class="text-sm text-gray-700">@drug.TypicalOnsetTiming</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-900 mb-2 flex items-center gap-1">
                                        <span>‚è≥</span> Duration
                                    </h4>
                                    <p class="text-sm text-gray-700">@drug.DurationOfEffects</p>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üß™</span> Expected Lab Changes
                                </h3>
                                <p class="text-gray-700 leading-relaxed">@drug.ExpectedLabChanges</p>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">üß†</span> Neurological Impacts
                                </h3>
                                <p class="text-gray-700 leading-relaxed">@drug.NeurologicalImpacts</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Clinical Tracking Sections -->
                    <div class="mt-8 pt-8 border-t-4 border-blue-200 space-y-6">
                        
                        <!-- Typical Timeline -->
                        @if(!string.IsNullOrEmpty(drug.TypicalTimeline))
                        {
                            <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500">
                                <h3 class="text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2">
                                    <span>üìÖ</span> Typical Timeline After Dose
                                </h3>
                                <pre class="text-gray-800 whitespace-pre-line font-sans leading-relaxed">@drug.TypicalTimeline</pre>
                            </div>
                        }
                        
                        <!-- Why Doctors Monitor -->
                        @if(!string.IsNullOrEmpty(drug.MonitoringReason))
                        {
                            <div class="bg-purple-50 p-6 rounded-lg border-l-4 border-purple-500">
                                <h3 class="text-2xl font-bold text-purple-900 mb-4 flex items-center gap-2">
                                    <span>ü©∫</span> Why Doctors Monitor This Drug Closely
                                </h3>
                                <pre class="text-gray-800 whitespace-pre-line font-sans leading-relaxed">@drug.MonitoringReason</pre>
                            </div>
                        }
                        
                        <!-- Common But Not Dangerous -->
                        @if(!string.IsNullOrEmpty(drug.CommonButNotDangerous))
                        {
                            <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500">
                                <h3 class="text-2xl font-bold text-green-900 mb-4 flex items-center gap-2">
                                    <span>‚úÖ</span> Common but NOT Dangerous
                                </h3>
                                <pre class="text-gray-800 whitespace-pre-line font-sans leading-relaxed">@drug.CommonButNotDangerous</pre>
                            </div>
                        }
                        
                        <!-- Blood Count Pattern -->
                        @if(!string.IsNullOrEmpty(drug.BloodCountPattern))
                        {
                            <div class="bg-amber-50 p-6 rounded-lg border-l-4 border-amber-500">
                                <h3 class="text-2xl font-bold text-amber-900 mb-4 flex items-center gap-2">
                                    <span>üß™</span> Blood Count Expectations
                                </h3>
                                <pre class="text-gray-800 whitespace-pre-line font-sans leading-relaxed">@drug.BloodCountPattern</pre>
                            </div>
                        }
                    </div>
                    
                    <!-- All Side Effects Section -->
                    <div class="mt-8 pt-8 border-t border-gray-200">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">All Side Effects by Severity</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <!-- Common -->
                            @if(drug.SideEffects.Any(se => se.Severity == "Common"))
                            {
                                <div>
                                    <h4 class="font-bold text-yellow-900 mb-3 flex items-center gap-2">
                                        <span class="bg-yellow-200 px-3 py-1 rounded-full text-sm">Common</span>
                                    </h4>
                                    <ul class="space-y-2">
                                        @foreach(var effect in drug.SideEffects.Where(se => se.Severity == "Common"))
                                        {
                                            <li class="text-sm">
                                                <p class="font-semibold text-gray-900">@effect.EffectName</p>
                                                <p class="text-gray-600">@effect.Description</p>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }
                            
                            <!-- Moderate -->
                            @if(drug.SideEffects.Any(se => se.Severity == "Moderate"))
                            {
                                <div>
                                    <h4 class="font-bold text-orange-900 mb-3 flex items-center gap-2">
                                        <span class="bg-orange-200 px-3 py-1 rounded-full text-sm">Moderate</span>
                                    </h4>
                                    <ul class="space-y-2">
                                        @foreach(var effect in drug.SideEffects.Where(se => se.Severity == "Moderate"))
                                        {
                                            <li class="text-sm">
                                                <p class="font-semibold text-gray-900">@effect.EffectName</p>
                                                <p class="text-gray-600">@effect.Description</p>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }
                            
                            <!-- Severe -->
                            @if(drug.SideEffects.Any(se => se.Severity == "Severe"))
                            {
                                <div>
                                    <h4 class="font-bold text-red-900 mb-3 flex items-center gap-2">
                                        <span class="bg-red-200 px-3 py-1 rounded-full text-sm">Severe</span>
                                    </h4>
                                    <ul class="space-y-2">
                                        @foreach(var effect in drug.SideEffects.Where(se => se.Severity == "Severe"))
                                        {
                                            <li class="text-sm">
                                                <p class="font-semibold text-gray-900">@effect.EffectName</p>
                                                <p class="text-gray-600">@effect.Description</p>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Empty State -->
    @if(!Model.Drugs.Any())
    {
        <div class="text-center py-12">
            <p class="text-gray-500">No drugs found.</p>
        </div>
    }

</div>
